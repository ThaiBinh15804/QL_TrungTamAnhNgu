@using QL_TrungTamAnhNgu.Models;

@model QL_TrungTamAnhNgu.Models.NhomNguoiDung

@{
    ViewBag.Title = "Test";
    Layout = "~/Views/Shared/_LayoutQuanTriVien.cshtml";
}



<style>
    /* Điều chỉnh khoảng cách và căn chỉnh */
    .form-container {
        max-width: 800px;
        margin: 0 auto;
    }

    .btn-actions {
        gap: 10px;
    }
</style>


<main id="content-start" class="content py-5" tabindex="-1">
    <div class="container form-container">
        <div>
            <h1 class="mb-4 h1 text-center">Thêm Nhóm</h1>
        </div>

        <!-- Form Start -->
        <form method="post" id="group_form" action="/QuanTriVien/XuLySuaNhomND/?MaNhomND=@Html.DisplayFor(model => model.MaNhomND)">

            <!-- Group Name -->
            <div class="mb-4">
                <label for="id_name" class="form-label fw-bold">Tên nhóm <span class="text-danger">*</span></label>
                <input type="text" name="TenNhomND" class="form-control" id="id_name" maxlength="150" readonly value="@Model.TenNhomND">
            </div>

            <!-- Permissions -->
            <div class="mb-4">
                <label for="id_permissions_from" class="form-label fw-bold">Quyền</label>
                <div class="row">
                    <!-- Available Permissions -->
                    <div class="col-md-5">
                        <h5 class="text-center">Quyền có sẵn</h5>
                        <select name="permissions_old" id="id_permissions_from" class="form-select" multiple size="10" style="max-width: 100%; overflow-x: auto; white-space: nowrap;">
                            @{
                                var roles = TempData["role"] as List<fn_VaiTro_KhongThuocNNDResult>;

                                if (roles != null)
                                {
                                    foreach (var item in roles)
                                    {
                                        <option value="@item.MaVaiTro">@item.TenVaiTro</option>
                                    }
                                }
                            }

                        </select>
                    </div>

                    <!-- Actions -->
                    <div class="col-md-2 d-flex flex-column align-items-center justify-content-center">
                        <button type="button" class="btn btn-primary mb-2" id="id_permissions_add_link">Chọn</button>
                        <button type="button" class="btn btn-secondary" id="id_permissions_remove_link">Bỏ chọn</button>
                    </div>

                    <!-- Chosen Permissions -->
                    <div class="col-md-5">
                        <h5 class="text-center">Quyền đã chọn</h5>
                        <select id="id_permissions_to" class="form-select" multiple size="10" name="permissions" style="max-width: 100%; overflow-x: auto; white-space: nowrap;">
                            @{
                                var roleNND = TempData["roleNhomND"] as List<VaiTro_NhomNguoiDung>;

                                if (roleNND != null)
                                {
                                    foreach (VaiTro_NhomNguoiDung item in roleNND)
                                    {
                                        <option value="@item.MaVaiTro">@item.VaiTro.TenVaiTro</option>
                                    }
                                }
                            }


                        </select>
                    </div>
                </div>
            </div>

            <!-- Submit Buttons -->
            <div class="d-flex justify-content-between btn-actions">
                <button type="submit" name="_save" class="btn btn-primary">Lưu</button>
                <a href="#" class="btn btn-secondary">Quay lại</a>
            </div>
        </form>
        <!-- Form End -->
    </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // Chuyển quyền từ danh sách "Quyền có sẵn" sang "Quyền đã chọn"
    document.getElementById("id_permissions_add_link").onclick = function () {
        var available = document.getElementById("id_permissions_from");
        var chosen = document.getElementById("id_permissions_to");

        for (var i = available.options.length - 1; i >= 0; i--) {
            if (available.options[i].selected) {
                // Đánh dấu quyền là mới
                available.options[i].setAttribute("data-new", "true");
                // Thêm vào danh sách "Quyền đã chọn"
                chosen.appendChild(available.options[i]);
            }
        }
    };

    // Chuyển quyền từ danh sách "Quyền đã chọn" về "Quyền có sẵn"
    document.getElementById("id_permissions_remove_link").onclick = function () {
        var chosen = document.getElementById("id_permissions_to");
        var available = document.getElementById("id_permissions_from");

        for (var i = chosen.options.length - 1; i >= 0; i--) {
            if (chosen.options[i].selected) {
                // Xóa thuộc tính đánh dấu nếu có
                available.options[i].setAttribute("data-new", "true");
                // Chuyển về danh sách "Quyền có sẵn"
                available.appendChild(chosen.options[i]);
            }
        }
    };

    // Xử lý trước khi gửi form
    document.getElementById("group_form").onsubmit = function () {
        var chosen = document.getElementById("id_permissions_to");

        // Gắn thêm giá trị vào hidden input để gửi quyền mới
        var newPermissions = [];
        for (var i = 0; i < chosen.options.length; i++) {
            if (chosen.options[i].hasAttribute("data-new")) {
                newPermissions.push(chosen.options[i].value);
            }
        }

        // Tạo hidden input để gửi danh sách quyền mới
        var input = document.createElement("input");
        input.type = "hidden";
        input.name = "new_permissions";
        input.value = newPermissions.join(",");
        this.appendChild(input);

        return true; // Tiếp tục gửi form
    };
</script>